<!DOCTYPE html>
<html xmlns:th="https://thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Agenda | WinPost</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="/css/estilo.css">

<style>
  </style>

</head>

<body class="d-flex flex-column min-vh-100 bg-light">

	<div th:replace="~{fragments/navbar :: navbar}"></div>

	<main class="flex-grow-1">
		<div style="margin-top: 80px;"></div>

		<div class="container py-4 mb-5">

			<div class="d-flex justify-content-between align-items-center mb-4">
				<div class="border-start border-4 border-primary ps-3">
					<h2 class="text-dark mb-0 fw-bold">Agenda</h2>
					<p class="text-muted small mb-0">Eventos e disparos do m√™s.</p>
				</div>

				<button class="btn btn-primary shadow-sm fw-bold"
					data-bs-toggle="modal" data-bs-target="#modalNovoEvento">
					<i class="fa-solid fa-plus me-2"></i>Novo Evento
				</button>
			</div>

			<div class="card card-modern shadow-sm border-0">

				<div class="calendar-header d-flex justify-content-between align-items-center flex-wrap gap-3">
					<div class="btn-group shadow-sm">
						<a th:href="@{/administrativo/agenda(mes=${mesExibicao == 1 ? 12 : mesExibicao - 1}, ano=${mesExibicao == 1 ? anoExibicao - 1 : anoExibicao})}"
							class="btn btn-outline-secondary btn-sm px-3"> <i class="fa-solid fa-chevron-left"></i>
						</a> 
						
						<a href="/administrativo/agenda" class="btn btn-outline-secondary btn-sm fw-bold px-3">M√™s</a> 
						
						<a th:href="@{/administrativo/agenda(mes=${mesExibicao == 12 ? 1 : mesExibicao + 1}, ano=${mesExibicao == 12 ? anoExibicao + 1 : anoExibicao})}"
							class="btn btn-outline-secondary btn-sm px-3"> <i class="fa-solid fa-chevron-right"></i>
						</a>
					</div>

					<h4 class="fw-bold text-dark mb-0 text-uppercase">
						<span th:text="${T(java.time.Month).of(mesExibicao).getDisplayName(T(java.time.format.TextStyle).FULL, T(java.util.Locale).forLanguageTag('pt-BR'))}">M√™s</span>
						<span th:text="${anoExibicao}" class="text-primary">2024</span>
					</h4>

					<div class="d-flex gap-3 small text-muted">
						<span class="d-flex align-items-center"><i class="fa-solid fa-square text-success me-2 fs-5 opacity-25"></i> Anivers√°rios</span> 
                        <span class="d-flex align-items-center"><i class="fa-solid fa-square text-primary me-2 fs-5 opacity-25"></i> Envios</span>
					</div>
				</div>

				<div class="calendar-grid">

					<div class="calendar-day-header">Dom</div>
					<div class="calendar-day-header">Seg</div>
					<div class="calendar-day-header">Ter</div>
					<div class="calendar-day-header">Qua</div>
					<div class="calendar-day-header">Qui</div>
					<div class="calendar-day-header">Sex</div>
					<div class="calendar-day-header">S√°b</div>

					<th:block th:if="${diaSemanaInicio != 7}">
						<div th:each="i : ${#numbers.sequence(0, diaSemanaInicio - 1)}" class="calendar-day day-empty"></div>
					</th:block>

					<th:block th:each="dia : ${#numbers.sequence(1, totalDiasMes)}">

						<div class="calendar-day"
							th:onclick="'verDetalhesDia(' + ${dia} + ',' + ${mesExibicao} + ',' + ${anoExibicao} + ')'"
							style="cursor: pointer;">

							<div class="day-number" th:text="${dia}"
								th:classappend="${dia == #temporals.createNow().dayOfMonth and mesExibicao == #temporals.createNow().monthValue and anoExibicao == #temporals.createNow().year} ? 'day-today'">
							</div>

							<th:block th:each="evento : ${listaEventos}">
								<div th:if="${evento.data.dayOfMonth == dia}"
									th:class="'event-badge ' + ${evento.cor}"
									th:title="${evento.titulo}">

									<i th:if="${evento.tipo == 'NIVER'}" class="fa-solid fa-cake-candles me-1"></i> 
                                    <i th:if="${evento.tipo == 'ENVIO'}" class="fa-solid fa-paper-plane me-1"></i> 
                                    <i th:if="${evento.tipo == 'FERIADO'}" class="fa-regular fa-calendar-check me-1"></i> 
                                    <i th:if="${evento.tipo == 'TAREFA'}" class="fa-solid fa-list-check me-1"></i> 
                                    <i th:if="${evento.tipo == 'REUNIAO'}" class="fa-solid fa-users me-1"></i> 
                                    <i th:if="${evento.tipo == 'IMPORTANTE'}" class="fa-solid fa-triangle-exclamation me-1"></i> 
                                    
                                    <span th:text="${evento.titulo}">T√≠tulo</span>
								</div>
							</th:block>
						</div>
					</th:block>

				</div>
			</div>

		</div>
	</main>

    <div class="modal fade" id="modalDetalhesDia" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border-0 shadow">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title fw-bold">
						<i class="fa-regular fa-calendar me-2"></i> <span id="modalTituloData">Detalhes</span>
					</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body p-0">
					<div id="listaDetalhes" class="list-group list-group-flush">
                        </div>

					<div id="msgVazio" class="text-center py-4 d-none">
						<i class="fa-regular fa-calendar-xmark fs-2 text-muted mb-2 opacity-50"></i>
						<p class="text-muted small mb-0">Nenhum evento registrado neste dia.</p>
					</div>
				</div>
				<div class="modal-footer bg-light border-0">
					<button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Fechar</button>
					<button type="button" class="btn btn-sm btn-primary fw-bold" id="btnAdicionarNestaData">
						<i class="fa-solid fa-plus me-1"></i> Adicionar
					</button>
				</div>
			</div>
		</div>
	</div>

    <div class="modal fade" id="modalNovoEvento" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg"> 
            <div class="modal-content border-0 shadow-lg overflow-hidden" style="border-radius: 20px;">
                
                <div class="modal-header border-0 pb-0 ps-4 pe-4 pt-4">
                    <h5 class="modal-title fw-bold text-dark fs-4">
                        <span class="text-primary me-2"><i class="fa-regular fa-calendar-plus"></i></span>
                        Novo Agendamento
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
    
                <form th:action="@{/administrativo/agenda/salvar}" method="post" th:object="${novoLembrete}">
                    <div class="modal-body p-4 pt-3">
                        
                        <div class="d-flex justify-content-between align-items-center mb-2 ms-1">
                            <label class="small fw-bold text-muted text-uppercase">Qual o tipo do evento?</label>
                            <button type="button" class="btn btn-sm btn-link text-decoration-none fw-bold" 
                                    onclick="alternarModoCriacao(true)" id="btnNovoTipo" style="font-size: 0.8rem;">
                                <i class="fa-solid fa-plus me-1"></i>Novo Tipo
                            </button>
                        </div>
    
                        <div id="areaSelecaoTipos" class="d-flex gap-3 mb-4 w-100 overflow-auto pb-2" style="flex-wrap: nowrap;">
                            
                            <input type="radio" class="btn-check" name="tipo" id="tipoTarefa" value="TAREFA" checked>
                            <label class="btn btn-outline-light text-start p-3 flex-fill border shadow-sm position-relative type-card" for="tipoTarefa" style="min-width: 140px;">
                                <div class="d-flex flex-column align-items-center text-center">
                                    <div class="icon-box bg-info bg-opacity-10 text-info rounded-circle mb-2 d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;">
                                        <i class="fa-solid fa-list-check"></i>
                                    </div>
                                    <div class="fw-bold text-dark small">Tarefa</div>
                                </div>
                                <div class="check-indicator text-info"><i class="fa-solid fa-circle-check"></i></div>
                            </label>
    
                            <input type="radio" class="btn-check" name="tipo" id="tipoReuniao" value="REUNIAO">
                            <label class="btn btn-outline-light text-start p-3 flex-fill border shadow-sm position-relative type-card" for="tipoReuniao" style="min-width: 140px;">
                                <div class="d-flex flex-column align-items-center text-center">
                                    <div class="icon-box bg-primary bg-opacity-10 text-primary rounded-circle mb-2 d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;">
                                        <i class="fa-solid fa-users"></i>
                                    </div>
                                    <div class="fw-bold text-dark small">Reuni√£o</div>
                                </div>
                                <div class="check-indicator text-primary"><i class="fa-solid fa-circle-check"></i></div>
                            </label>
                            
                            <input type="radio" class="btn-check" name="tipo" id="tipoImportante" value="IMPORTANTE">
                            <label class="btn btn-outline-light text-start p-3 flex-fill border shadow-sm position-relative type-card" for="tipoImportante" style="min-width: 140px;">
                                <div class="d-flex flex-column align-items-center text-center">
                                    <div class="icon-box bg-danger bg-opacity-10 text-danger rounded-circle mb-2 d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;">
                                        <i class="fa-solid fa-triangle-exclamation"></i>
                                    </div>
                                    <div class="fw-bold text-dark small">Urgente</div>
                                </div>
                                <div class="check-indicator text-danger"><i class="fa-solid fa-circle-check"></i></div>
                            </label>
    
                            <th:block th:each="tp : ${tiposPersonalizados}">
                                <input type="radio" class="btn-check" name="tipo" th:id="'tipo' + ${tp.id}" th:value="${tp.nome}">
                                <label class="btn btn-outline-light text-start p-3 flex-fill border shadow-sm position-relative type-card" 
                                       th:for="'tipo' + ${tp.id}" style="min-width: 140px;" 
                                       th:styleappend="'--cor-personalizada: ' + ${tp.corHex}">
                                    <div class="d-flex flex-column align-items-center text-center">
                                        <div class="icon-box bg-opacity-10 rounded-circle mb-2 d-flex align-items-center justify-content-center" 
                                             style="width: 35px; height: 35px;"
                                             th:style="'background-color: ' + ${tp.corHex} + '20; color: ' + ${tp.corHex}">
                                            <i class="fa-solid" th:classappend="${tp.icone}"></i>
                                        </div>
                                        <div class="fw-bold text-dark small" th:text="${tp.nome}">Personalizado</div>
                                    </div>
                                    <div class="check-indicator" th:style="'color: ' + ${tp.corHex}"><i class="fa-solid fa-circle-check"></i></div>
                                </label>
                            </th:block>
                        </div>
    
                        <div id="areaCriacaoTipo" class="card bg-light border-0 p-3 mb-4 d-none position-relative">
                            <button type="button" class="btn-close position-absolute top-0 end-0 m-2" onclick="alternarModoCriacao(false)"></button>
                            
                            <h6 class="small fw-bold text-muted mb-3">CRIAR NOVA CATEGORIA</h6>
                            
                            <div class="row g-2 align-items-center">
                                <div class="col-6">
                                    <input type="text" id="novoTipoNome" class="form-control form-control-sm" placeholder="Ex: Academia, M√©dico...">
                                </div>
                                
                                <div class="col-4">
                                    <select id="novoTipoIcone" class="form-select form-select-sm font-awesome-select">
                                        <option value="fa-star">‚òÖ Geral</option>
                                        <option value="fa-dumbbell">üèãÔ∏è Treino</option>
                                        <option value="fa-plane">‚úàÔ∏è Viagem</option>
                                        <option value="fa-briefcase">üíº Trabalho</option>
                                        <option value="fa-heart-pulse">‚ù§Ô∏è Sa√∫de</option>
                                        <option value="fa-graduation-cap">üéì Estudo</option>
                                        <option value="fa-cart-shopping">üõí Compra</option>
                                    </select>
                                </div>
                        
                                <div class="col-2">
                                    <input type="color" id="novoTipoCor" class="form-control form-control-sm form-control-color w-100" value="#6610f2" title="Escolha a cor">
                                </div>
                                
                                <div class="col-12 mt-2 text-end">
                                    <button type="button" class="btn btn-primary btn-sm rounded-pill px-3" onclick="salvarNovoTipo()">
                                        Salvar Tipo
                                    </button>
                                </div>
                            </div>
                        </div>                
    
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control fw-bold fs-5 text-dark border-0 border-bottom rounded-0 px-1 bg-transparent" 
                                   id="inputTitulo" name="titulo" placeholder="T√≠tulo" required style="box-shadow: none;">
                            <label for="inputTitulo" class="px-1 text-muted">O que vamos fazer?</label>
                        </div>
    
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="small fw-bold text-muted ms-1 mb-1">DATA & HORA</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0 text-muted"><i class="fa-regular fa-clock"></i></span>
                                    <input type="datetime-local" class="form-control bg-light border-start-0 ps-0 text-dark fw-bold" name="dataHora" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="small fw-bold text-muted ms-1 mb-1">VINCULAR (OPCIONAL)</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0 text-muted"><i class="fa-solid fa-user-tag"></i></span>
                                    <select class="form-select bg-light border-start-0 ps-0" name="contato">
                                        <option value="">Sem v√≠nculo</option>
                                        <option th:each="c : ${todosContatos}" th:value="${c.id}" th:text="${c.nome}"></option>
                                    </select>
                                </div>
                            </div>
                        </div>
    
                        <div class="mb-2">
                            <label class="small fw-bold text-muted ms-1 mb-1">DETALHES</label>
                            <textarea class="form-control bg-light border-0" name="descricao" rows="3" placeholder="Escreva observa√ß√µes, links ou endere√ßos aqui..." style="resize: none;"></textarea>
                        </div>
    
                    </div>
                    
                    <div class="modal-footer border-0 px-4 pb-4 pt-0">
                        <button type="button" class="btn btn-light px-4 text-muted fw-bold rounded-pill" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary px-5 fw-bold rounded-pill shadow-sm">
                            <i class="fa-solid fa-check me-2"></i>Agendar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalLeitura" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 12px;">
                <div class="modal-header border-bottom-0 pb-0">
                    <h5 class="modal-title fw-bold" id="modalAssunto">Assunto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3 fs-5"
                            style="width: 40px; height: 40px;">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="fw-bold text-dark">Envio do Sistema</span>
                            </div>
                            <div class="text-muted small">
                                para <span id="modalGrupo" class="text-dark fw-bold">Grupo</span>
                            </div>
                        </div>
                        <div class="ms-auto text-muted small" id="modalData">Data</div>
                    </div>

                    <div class="p-3 bg-light rounded-3 mb-3 border">
                        <div id="modalConteudo" style="font-family: sans-serif;"></div>
                    </div>

                    <div id="areaAnexosModal" class="d-none mt-3 border-top pt-3">
                        <h6 class="small fw-bold text-muted mb-2">
                            <i class="fa-solid fa-paperclip me-1"></i>Anexos
                        </h6>
                        <div class="d-flex gap-2">
                            <span class="badge bg-light text-dark border"><i class="fa-solid fa-file"></i>
                                <span id="modalAnexos"></span></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-top-0 pt-0">
                    <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

	<div class="footer" th:replace="~{fragments/footer :: footer}"></div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	<script th:src="@{/js/agenda.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>