<!DOCTYPE html>
<html xmlns:th="https://thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Editar Grupo | WinPost</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<link rel="stylesheet" href="/css/estilo.css">
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

	<div th:replace="~{fragments/navbar :: navbar}"></div>

	<main class="flex-grow-1">
		<div style="margin-top: 80px;"></div>

		<div class="container py-4 mb-5">

            <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show shadow-sm border-0 rounded-3 mb-4">
				<i class="fa-solid fa-check-circle me-2"></i> <span th:text="${mensagemSucesso}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div class="d-flex justify-content-between align-items-center mb-4">
				<h2 class="text-dark mb-0 fw-bold">Editar Grupo</h2>
				<a href="/grupos/gerenciar" class="btn btn-outline-secondary btn-sm">
					<i class="fa-solid fa-arrow-left me-1"></i> Voltar
				</a>
			</div>

			<div class="row g-4">
				<div class="col-lg-4">
					<form action="/grupos/atualizar" method="post" th:object="${grupo}">
						<input type="hidden" th:field="*{id}">

						<div class="card card-modern mb-4">
							<div class="card-header fw-bold text-primary">Dados do Grupo</div>
							<div class="card-body">
								<div class="mb-3">
									<label class="form-label small fw-bold text-muted">NOME</label>
									<input type="text" class="form-control" th:field="*{nome}" required>
								</div>
								<div class="mb-3">
									<label class="form-label small fw-bold text-muted">DESCRIÇÃO</label>
									<textarea class="form-control" th:field="*{descricao}" rows="3"></textarea>
								</div>

								<div class="d-grid gap-2">
									<button type="submit" class="btn btn-primary fw-bold">
										<i class="fa-solid fa-check me-2"></i>Salvar Alterações
									</button>

                                    <button type="button" 
                                            class="btn btn-outline-danger btn-sm"
                                            th:data-url="@{/grupos/excluir/{id}(id=*{id})}"
                                            onclick="confirmarExclusao(this.getAttribute('data-url'))">
										<i class="fa-solid fa-trash-can me-2"></i>Excluir este Grupo
									</button>
								</div>

							</div>
						</div>

                        <div class="card card-modern h-100">
    <div class="card-header fw-bold bg-white text-dark d-flex align-items-center">
        <div class="bg-light rounded-circle p-2 me-2 d-flex align-items-center justify-content-center" style="width: 35px; height: 35px;">
            <i class="fa-solid fa-user-plus text-primary"></i>
        </div>
        <span>Adicionar Novos Membros</span>
    </div>
    
    <div class="card-body">
        <p class="small text-muted mb-3">Busque e selecione os contatos que deseja incluir neste grupo:</p>
        
        <div class="mb-3">
            <select class="form-select select2-multiple" name="novosMembros" multiple="multiple" style="width: 100%">
                <option th:each="c : ${todosContatos}" 
                        th:value="${c.id}" 
                        th:text="${c.nome}"
                        th:data-nome="${c.nome}"
                        th:data-email="${c.email}">
                </option>
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary w-100 btn-modern">
            <i class="fa-solid fa-plus me-2"></i>Adicionar Selecionados
        </button>
    </div>
</div>					</form>
				</div>

                <div class="col-lg-8">
					<div class="card card-modern h-100">
                        <div class="card-header bg-white"><span class="fw-bold text-dark">Membros Atuais</span></div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-hover align-middle mb-0">
									<thead class="bg-light">
										<tr><th class="ps-4">Nome</th><th>Email</th><th class="text-end pe-4">Ação</th></tr>
									</thead>
									<tbody>
										<tr th:each="membro : ${grupo.contatos}">
											<td class="ps-4 fw-bold" th:text="${membro.nome}">Nome</td>
											<td class="small text-muted" th:text="${membro.email}">Email</td>
											<td class="text-end pe-4">
                                                <a th:href="@{/grupos/removerMembro/{grupoId}/{contatoId}(grupoId=${grupo.id}, contatoId=${membro.id})}"
												class="btn btn-sm btn-light text-danger border hover-danger"
												onclick="return confirm('Remover este usuário do grupo?');"> 
                                                <i class="fa-solid fa-user-minus"></i></a>
                                            </td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

    <div th:replace="~{fragments/modals :: modalExclusao}"></div>

	<div class="footer" th:replace="~{fragments/footer :: footer}"></div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="/js/grupos.js"></script>

	<script>
        // Função do Modal de Exclusão
        function confirmarExclusao(url) {
            var modalElement = document.getElementById('modalConfirmarExclusao');
            if(modalElement){
                var modal = new bootstrap.Modal(modalElement);
                var btnConfirmar = document.getElementById('btnConfirmarExclusao');
                if(btnConfirmar) btnConfirmar.setAttribute('href', url);
                modal.show();
            } else {
                console.error("Modal de exclusão não encontrado no fragmento.");
            }
        }
    </script>

    <script th:if="${mensagemSucesso}">
        Swal.fire({
            title: 'Sucesso!',
            text: '[[${mensagemSucesso}]]',
            icon: 'success',
            confirmButtonColor: '#0d6efd',
            timer: 3000
        });
    </script>
</body>
</html>

	
</body>
</html>