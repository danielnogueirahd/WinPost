<!DOCTYPE html>
<html xmlns:th="https://thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gerenciar Grupos | WinPost</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="/css/estilo.css">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css"
	rel="stylesheet">

</head>


<body class="d-flex flex-column min-vh-100 bg-light">

	<div th:replace="~{fragments/navbar :: navbar}"></div>
	<div th:replace="~{fragments/sidebar :: sidebar('gerenciarGrupo')}"></div>

	<main class="flex-grow-1">
		<div style="margin-top: 80px;"></div>

		<div class="container py-4 mb-5">

			<div th:if="${mensagemSucesso}"
				class="alert alert-success alert-dismissible fade show shadow-sm border-0 rounded-3 mb-4">
				<i class="fa-solid fa-check-circle me-2"></i> <span
					th:text="${mensagemSucesso}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div th:if="${mensagemErro}"
				class="alert alert-danger alert-dismissible fade show shadow-sm border-0 rounded-3 mb-4">
				<i class="fa-solid fa-triangle-exclamation me-2"></i> <span
					th:text="${mensagemErro}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="text-dark mb-0 fw-bold">Gerenciar Grupos</h2>
        <p class="text-muted small">Visualize, edite ou exclua seus grupos de contatos.</p>
    </div>
    
    <div class="d-flex gap-2">
        <a href="/mensagens/enviadas" 
           class="btn btn-light text-secondary border shadow-sm rounded-pill px-3 fw-bold" 
           title="Ver Histórico de Envios">
            <i class="fa-solid fa-clock-rotate-left me-2"></i> Histórico
        </a>

        <a href="/grupos/cadastro" 
           class="btn btn-primary rounded-pill px-4 fw-bold shadow-sm">
            <i class="fa-solid fa-plus me-2"></i> Novo Grupo
        </a>
    </div>
</div>
			<div class="row mb-4 g-4" th:if="${!#lists.isEmpty(listaGrupos)}">
				<div class="col-md-4 col-sm-6">
					<div class="card-modern p-3 d-flex flex-row align-items-center">
						<div class="rounded-circle bg-light p-3 text-primary me-3">
							<i class="fa-solid fa-layer-group fs-4"></i>
						</div>
						<div>
							<h6 class="text-muted text-uppercase small fw-bold mb-0">Total
								de Grupos</h6>
							<h3 class="fw-bold mb-0 text-dark"
								th:text="${#lists.size(listaGrupos)}">0</h3>
						</div>
					</div>
				</div>
			</div>

			<div class="row g-4">
				<div class="col-12">
					<div class="card card-modern border-0 shadow-sm">
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-hover align-middle mb-0">
									<thead class="bg-white border-bottom">
										<tr>
											<th class="ps-4 text-uppercase text-secondary small py-3">Grupo</th>
											<th class="text-uppercase text-secondary small py-3">Descrição</th>
											<th
												class="text-center text-uppercase text-secondary small py-3">Total
												Membros</th>
											<th
												class="text-end pe-4 text-uppercase text-secondary small py-3">Ações</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="grupo : ${listaGrupos}">
											<td class="ps-4">
												<div class="d-flex align-items-center">
													<div
														class="rounded-3 bg-primary bg-opacity-10 text-dark d-flex align-items-center justify-content-center me-3 shadow-sm"
														style="width: 40px; height: 40px; min-width: 40px;">
														<i class="fa-solid fa-users"></i>
													</div>
													<div>
														<h6 class="mb-0 fw-bold text-dark" th:text="${grupo.nome}">Nome
															do Grupo</h6>
														<span class="text-muted small" style="font-size: 0.75rem;">ID:
															<span th:text="${grupo.id}">#</span>
														</span>
													</div>
												</div>
											</td>

											<td>
												<div class="d-flex align-items-center text-muted"
													style="max-width: 280px;">
													<span class="d-inline-block text-truncate"
														th:if="${grupo.descricao != null and !grupo.descricao.isEmpty()}"
														th:text="${grupo.descricao}" title="${grupo.descricao}">
														Descrição do grupo... </span> <span
														class="fst-italic opacity-50 small"
														th:if="${grupo.descricao == null or grupo.descricao.isEmpty()}">
														Sem descrição definida </span>
												</div>
											</td>

											<td class="text-center">
												<div
													class="d-inline-flex align-items-center bg-primary bg-opacity-10 text-dark border border-primary border-opacity-10 px-3 py-1 rounded-pill">
													<i class="fa-solid fa-user-group me-2 small"></i> <span
														class="fw-bold small"
														th:text="${#lists.size(grupo.contatos)}">0</span>
												</div>
											</td>

											<td class="text-end pe-4">
												<div class="btn-group shadow-sm">
													<button type="button"
														class="btn btn-sm btn-light border text-success"
														th:data-id="${grupo.id}" th:data-nome="${grupo.nome}"
														onclick="prepararDisparo(this)" title="Disparar Mensagem"
														data-bs-toggle="modal" data-bs-target="#modalDisparo">
														<i class="fa-regular fa-paper-plane"></i>
													</button>

													<a th:href="@{/grupos/editar/{id}(id=${grupo.id})}"
														class="btn btn-sm btn-light border text-primary"
														title="Editar"> <i class="fa-solid fa-pen-to-square"></i>
													</a> <a th:href="@{/grupos/excluir/{id}(id=${grupo.id})}"
														class="btn btn-sm btn-light border text-danger"
														onclick="return confirm('Tem certeza que deseja excluir este grupo inteiro?');"
														title="Excluir"> <i class="fa-solid fa-trash-can"></i>
													</a>
												</div>
											</td>

										</tr>

										<tr th:if="${#lists.isEmpty(listaGrupos)}">
											<td colspan="4" class="text-center py-5">
												<div
													class="d-flex flex-column align-items-center justify-content-center text-muted opacity-50">
													<i class="fa-solid fa-folder-open display-4 mb-3"></i>
													<h5 class="fw-light">Nenhum grupo encontrado</h5>
													<p class="small mb-0">Crie um novo grupo para começar.</p>
												</div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<div class="modal fade" id="modalDisparo" tabindex="-1"
		aria-hidden="true" data-bs-backdrop="static">
		<div class="modal-dialog modal-lg modal-dialog-scrollable">
			<div class="modal-content shadow-lg"
				style="border-radius: 8px; border: none;">

				<div
					class="modal-header bg-light py-2 px-3 border-bottom-0 d-flex justify-content-between align-items-center">
					<h6 class="modal-title fw-bold small text-secondary">Nova
						mensagem</h6>
					<div class="d-flex gap-2">
						<button type="button" class="btn btn-sm btn-link text-muted p-0">
							<i class="fa-solid fa-minus"></i>
						</button>
						<button type="button" class="btn btn-sm btn-link text-muted p-0">
							<i class="fa-solid fa-expand"></i>
						</button>
						<button type="button" class="btn btn-sm btn-link text-muted p-0"
							data-bs-dismiss="modal">
							<i class="fa-solid fa-xmark"></i>
						</button>
					</div>
				</div>

				<form action="/grupos/disparar" method="post"
					enctype="multipart/form-data" class="d-flex flex-column h-100">
					<input type="hidden" name="grupoId" id="inputGrupoId">

					<div class="modal-body p-0 d-flex flex-column">

						<div class="px-3 py-2 border-bottom">
							<div class="d-flex align-items-center">
								<span class="text-muted small me-2">Para</span> <span
									id="nomeGrupoDisplay"
									class="badge bg-light text-dark border rounded-pill px-3">...</span>
							</div>
						</div>

						<div class="px-3 py-2 border-bottom">
							<input type="text"
								class="form-control border-0 shadow-none p-0 fw-bold"
								name="assunto" placeholder="Assunto" required>
						</div>

						<div class="flex-grow-1">
							<textarea id="summernote" name="mensagem"></textarea>
						</div>

						<input type="file" id="inputAnexos" name="anexos" multiple
							style="display: none;">
					</div>

					<div
						class="modal-footer justify-content-between px-3 py-2 border-top-0">
						<div class="d-flex align-items-center gap-3">
							<div class="btn-group dropup">
								<button type="submit"
									class="btn btn-primary rounded-pill px-4 fw-bold">Enviar</button>
								<button type="button"
									class="btn btn-primary dropdown-toggle dropdown-toggle-split rounded-pill rounded-start-0 ps-1 pe-2"
									data-bs-toggle="dropdown" aria-expanded="false">
									<span class="visually-hidden">Toggle Dropdown</span>
								</button>
								<ul class="dropdown-menu">
									<li><a class="dropdown-item" href="#">Programar envio</a></li>
								</ul>
							</div>

							<div class="d-flex gap-3 text-secondary fs-5 align-items-center">
								<i class="fa-solid fa-font cursor-pointer"
									title="Formatar (Automático no Editor)"
									style="cursor: pointer;"></i> <i
									class="fa-solid fa-paperclip cursor-pointer hover-effect"
									onclick="document.getElementById('inputAnexos').click()"
									title="Anexar arquivos" style="cursor: pointer;"></i> <i
									class="fa-regular fa-face-smile cursor-pointer hover-effect"
									style="cursor: pointer;"></i> <i
									class="fa-brands fa-google-drive cursor-pointer hover-effect"
									style="cursor: pointer;"></i> <i
									class="fa-regular fa-image cursor-pointer hover-effect"
									style="cursor: pointer;"></i> <i
									class="fa-solid fa-lock cursor-pointer hover-effect"
									title="Modo confidencial" style="cursor: pointer;"></i>
							</div>
						</div>

						<button type="button"
							class="btn btn-light text-secondary border-0"
							data-bs-dismiss="modal" title="Descartar rascunho">
							<i class="fa-regular fa-trash-can"></i>
						</button>
					</div>

					<div id="listaAnexos" class="px-3 pb-2 small text-muted"></div>
				</form>
			</div>
		</div>
	</div>

	<div class="footer" th:replace="~{fragments/footer :: footer}"></div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

    <script>
        $(document).ready(function() {
            // Inicializa o Summernote
            $('#summernote').summernote({
                placeholder: 'Digite sua mensagem aqui...',
                tabsize: 2,
                height: 300,
                toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'underline', 'clear']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture']],
                    ['view', ['fullscreen', 'codeview', 'help']]
                ],
                disableResizeEditor: true
            });

            // Mostra os nomes dos arquivos ao selecionar
            $('#inputAnexos').change(function() {
                var files = $(this)[0].files;
                var nomes = "";
                for (var i = 0; i < files.length; i++) {
                    nomes += '<span class="badge bg-light text-dark border me-1"><i class="fa-solid fa-paperclip me-1"></i>' + files[i].name + '</span>';
                }
                $('#listaAnexos').html(nomes);
            });
        });

        // Função para passar os dados para o modal
        function prepararDisparo(botao) {
            var id = botao.getAttribute('data-id');
            var nome = botao.getAttribute('data-nome');
            
            document.getElementById('inputGrupoId').value = id;
            document.getElementById('nomeGrupoDisplay').innerText = nome;
        }

        // Função do menu lateral
        function toggleMenu(menuId, iconId) {
            var menu = document.getElementById(menuId);
            var icon = document.getElementById(iconId);
            if (menu) {
                if (menu.classList.contains('d-none')) {
                    menu.classList.remove('d-none');
                    if(icon) { icon.classList.remove('fa-chevron-down'); icon.classList.add('fa-chevron-up'); }
                } else {
                    menu.classList.add('d-none');
                    if(icon) { icon.classList.remove('fa-chevron-up'); icon.classList.add('fa-chevron-down'); }
                }
            }
        }
    </script>
</body>
</html>
